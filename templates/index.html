<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epishi: Grados y Títulos</title>
    <link rel="stylesheet" href="static/styles/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body class="light-theme">
  <div class="container">
    <div class="chat-panel">
        <div class="chat-display" id="chat-display">
            <!-- Mensaje de introducción dinámico aquí -->
        </div>
        <div class="input-area">
            <input type="text" id="prompt-input" placeholder="Consulta...">
            <button id="send-button" title="Send"><i class="fas fa-paper-plane"></i></button>
            <button id="clear-button" title="Clear Chat"><i class="fas fa-trash"></i></button>
        </div>
    </div>
        <div class="info-panel">
            <div class="info-panel-content">
                <img id="logo" src="static/styles/bot_unam_ico.png" alt="aimaraBot Logo">

                <div class="info-text">
                    <h2>AI-MARA CHATBOT</h2>
                    <p><strong>Consultas al reglamento de grados y títulos de la Universidad Nacional de Moquegua</strong></p>
                    <ul class="feature-list">
                        <li><i class="fas fa-robot"></i> AI-powered chatbot</li>
                        <li><i class="fas fa-brain"></i> Basado en LSTM</li>
                        <li><i class="fas fa-comment-dots"></i> Natural language processing</li>
                        <li><i class="fas fa-lightbulb"></i> Intelligent reasoning</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="credits-panel">
          <div class="credits-content">
              <h3>Créditos</h3>
              <div class="credit-section">
                  <h4>Desarrollo</h4>
                  <p>Jamir Balcona</p>
                  <div class="social-icons">
                    <a href="#" class="icon-link" title="LinkedIn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.47,2H3.53A1.45,1.45,0,0,0,2.06,3.43V20.57A1.45,1.45,0,0,0,3.53,22H20.47a1.45,1.45,0,0,0,1.47-1.43V3.43A1.45,1.45,0,0,0,20.47,2ZM8.09,18.74h-3v-9h3ZM6.59,8.48A1.56,1.56,0,1,1,8.15,6.92,1.57,1.57,0,0,1,6.59,8.48ZM18.91,18.74h-3V13.91c0-1.21-.43-2-1.52-2A1.65,1.65,0,0,0,12.85,13a2,2,0,0,0-.1.73v5h-3s0-8.18,0-9h3V11A3,3,0,0,1,15.46,9.5c2,0,3.45,1.29,3.45,4.06Z"/></svg>
                    </a>
                    <a href="#" class="icon-link" title="Portafolio">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20,6H16V5a3,3,0,0,0-3-3H11A3,3,0,0,0,8,5V6H4A2,2,0,0,0,2,8V19a2,2,0,0,0,2,2H20a2,2,0,0,0,2-2V8A2,2,0,0,0,20,6ZM10,5a1,1,0,0,1,1-1h2a1,1,0,0,1,1,1V6H10Zm10,14H4V8H20Z"/></svg>
                    </a>
                </div>
                  <p>Elmer Collanqui</p>
                  <div class="social-icons">
                      <a href="#" class="icon-link" title="LinkedIn">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.47,2H3.53A1.45,1.45,0,0,0,2.06,3.43V20.57A1.45,1.45,0,0,0,3.53,22H20.47a1.45,1.45,0,0,0,1.47-1.43V3.43A1.45,1.45,0,0,0,20.47,2ZM8.09,18.74h-3v-9h3ZM6.59,8.48A1.56,1.56,0,1,1,8.15,6.92,1.57,1.57,0,0,1,6.59,8.48ZM18.91,18.74h-3V13.91c0-1.21-.43-2-1.52-2A1.65,1.65,0,0,0,12.85,13a2,2,0,0,0-.1.73v5h-3s0-8.18,0-9h3V11A3,3,0,0,1,15.46,9.5c2,0,3.45,1.29,3.45,4.06Z"/></svg>
                      </a>
                      <a href="#" class="icon-link" title="Portafolio">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20,6H16V5a3,3,0,0,0-3-3H11A3,3,0,0,0,8,5V6H4A2,2,0,0,0,2,8V19a2,2,0,0,0,2,2H20a2,2,0,0,0,2-2V8A2,2,0,0,0,20,6ZM10,5a1,1,0,0,1,1-1h2a1,1,0,0,1,1,1V6H10Zm10,14H4V8H20Z"/></svg>
                      </a>
                  </div>
              </div>
              <div class="credit-section">
                  <h4>Modelado</h4>
                  <p>Allison Reynoso</p>
                  <p>Seline Maquera</p>
              </div>
              <div class="version">Versión 2.0</div>
              <div class="copyright">© 2024 Aimara Group</div>
          </div>
      </div>
      <div class="overlay" id="overlay"></div>

    </div>
    <button id="theme-toggle" title="Toggle Theme"><i class="fas fa-adjust"></i></button>
    <button id="info-toggle" title="Toggle Info Panel"><i class="fas fa-info-circle"></i></button>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('theme-toggle');
            const infoToggle = document.getElementById('info-toggle');
            const creditsPanel = document.querySelector('.credits-panel');
            const overlay = document.getElementById('overlay');
            
            const chatDisplay = document.getElementById('chat-display');
            const promptInput = document.getElementById('prompt-input');
            const sendButton = document.getElementById('send-button');
            const clearButton = document.getElementById('clear-button');
            const sidebarToggle = document.createElement('button'); // Botón para sidebar
            const infoPanel = document.querySelector('.info-panel');
            let startX, startY, moveX, moveY;

            const examples = [
            "¿Cuáles son los requisitos para obtener el grado academico de bachiller?",
            "Explícame el procedimiento para solicitar mi titulación.",
            "¿Cómo inicio tramite de proyecto de tesis?",
            "¿Cómo presento mi tesis depues de la sustentación?"
        ];

        
        // Crear y posicionar el botón de sidebar
        sidebarToggle.id = 'sidebar-toggle';
        sidebarToggle.title = 'Ocultar Sidebar';
        sidebarToggle.innerHTML = '<i class="fas fa-bars"></i>';
        document.querySelector('.input-area').appendChild(sidebarToggle); // Agregar al lado derecho

        // Alternar visibilidad del sidebar
        sidebarToggle.addEventListener('click', () => {
            infoPanel.classList.toggle('hidden'); // Oculta o muestra el sidebar
        });


    // Añadir un mensaje al chat
    function appendMessage(sender, message, isHTML = false, extraClass = '') {
        const messageElement = document.createElement('div');
        messageElement.className = `message ${sender === 'Tú' ? 'user-message' : 'aimaraBot-message'} ${extraClass}`;
        messageElement.innerHTML = isHTML ? message : `<strong>${sender}:</strong> ${message}`;
        chatDisplay.appendChild(messageElement);
        chatDisplay.scrollTop = chatDisplay.scrollHeight;
    }

    function renderWelcomeMessage() {
        const welcomeHTML = `
            <div class="welcome-container">
                <h3 class="welcome-title">Hola, soy <span class="highlight">AI-MARA bot</span></h3>
                <p class="welcome-text">¿En qué puedo ayudarte con los trámites de grados y títulos?</p>
                <div class="examples-buttons">
                    ${examples.map(example => 
                        `<button class="example-btn">${example}</button>`
                    ).join('')}
                </div>
            </div>
        `;
        appendMessage('AI-MARA Bot', welcomeHTML, true, 'introduction-message');
    
        // Agregar eventos a los botones de ejemplo
        const exampleButtons = document.querySelectorAll('.example-btn');
        exampleButtons.forEach(button => {
            button.addEventListener('click', () => {
                sendMessage(button.textContent);
            });
        });
    }
        
 // Enviar mensaje
 async function sendMessage(customMessage = null) {
    const message = customMessage || promptInput.value.trim();
    if (!message) return;

    appendMessage('Tú', message); // Mensaje del usuario
    promptInput.value = ''; // Limpiar el campo de entrada

    try {
        const response = await fetch('/get', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message }),
        });

        if (response.ok) {
            const data = await response.json();
            appendMessage('AI-MARA Bot', data.response); // Respuesta del bot
        } else {
            throw new Error('El servidor no está respondiendo correctamente.');
        }
    } catch (error) {
        console.error('Error:', error);
        appendMessage('AI-MARA Bot', 'Lo siento, intenta de nuevo.');
    }
}


    // Limpiar chat y restaurar mensaje de bienvenida
    clearButton.addEventListener('click', function () {
        chatDisplay.innerHTML = ''; // Limpiar historial
        renderWelcomeMessage(); // Restaurar mensaje de introducción
    });

    // Enviar mensaje con botón
    sendButton.addEventListener('click', () => sendMessage());

    // Enviar mensaje al presionar Enter
    promptInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
            sendMessage();
        }
    });

    // Renderizar mensaje de bienvenida al cargar
    renderWelcomeMessage();


        
            function toggleTheme() {
                document.body.classList.toggle('light-theme');
                const theme = document.body.classList.contains('light-theme') ? 'light' : 'dark';
                localStorage.setItem('theme', theme);
            }
        
            function toggleInfoPanel() {
                infoPanel.classList.toggle('show');
                creditsPanel.classList.toggle('show');
                overlay.classList.toggle('show');
                
                if (creditsPanel.classList.contains('show')) {
                    animateCredits();
                }
            }
            
            
            function handleTouchStart(e) {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            }
            
            function handleTouchStart(e) {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            }
        
            function handleTouchMove(e) {
                if (!startX || !startY) return;
        
                moveX = e.touches[0].clientX;
                moveY = e.touches[0].clientY;
        
                const diffX = startX - moveX;
                const diffY = startY - moveY;
        
                if (Math.abs(diffX) > Math.abs(diffY)) {
                    e.preventDefault();
                    if (diffX > 0) {
                        infoPanel.style.transform = `translateX(${-diffX}px)`;
                        creditsPanel.style.transform = `translateX(${-diffX}px)`;
                    }
                }
            }
        
            function handleTouchEnd() {
                const diffX = startX - moveX;
                if (diffX > 50) {
                    infoPanel.classList.remove('show');
                    creditsPanel.classList.remove('show');
                    overlay.classList.remove('show');
                } else {
                    infoPanel.style.transform = '';
                    creditsPanel.style.transform = '';
                }
                startX = null;
                startY = null;
            }
        
            if (infoToggle) infoToggle.addEventListener('click', toggleInfoPanel);
            
            infoPanel.addEventListener('touchstart', handleTouchStart);
            infoPanel.addEventListener('touchmove', handleTouchMove);
            infoPanel.addEventListener('touchend', handleTouchEnd);
        
            creditsPanel.addEventListener('touchstart', handleTouchStart);
            creditsPanel.addEventListener('touchmove', handleTouchMove);
            creditsPanel.addEventListener('touchend', handleTouchEnd);
        
            overlay.addEventListener('click', toggleInfoPanel);
            
            function animateCredits() {
                const elements = creditsPanel.querySelectorAll('h3, .credit-section, .version, .copyright');
                elements.forEach((el, index) => {
                    el.style.opacity = '0';
                    el.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        el.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                        el.style.opacity = '1';
                        el.style.transform = 'translateY(0)';
                    }, index * 100);
                });
            }
        
            function animateBrain() {
                const paths = document.querySelectorAll('#brain-visualization path:not(#brain-outline)');
                paths.forEach((path, index) => {
                    setTimeout(() => {
                        path.style.strokeDasharray = path.getTotalLength();
                        path.style.strokeDashoffset = path.getTotalLength();
                        path.style.animation = 'drawPath 2s forwards';
                    }, index * 200);
                });
            }
        
            if (sendButton) sendButton.addEventListener('click', sendMessage);
            if (themeToggle) themeToggle.addEventListener('click', toggleTheme);
            if (infoToggle) infoToggle.addEventListener('click', toggleInfoPanel);
        
            if (promptInput) {
                promptInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
        
            // Initialize theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
            }
        
            // Animate brain on load
            animateBrain();
        
            // Handle window resize
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    infoPanel.classList.remove('show', 'hide');
                    creditsPanel.classList.remove('show', 'hide');
                }
            });

        });
    </script>
  </body>
  </html>